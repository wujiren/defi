这份《验证门控标准说明文档》的 Markdown 版本如下：

---

# DeFi 自动化交易基础设施：验证门控标准说明文档

**Validation Quality Gate Standard**

| PRD 附属文档 | 版本 1.0 | 2026-02-25 |
| --- | --- | --- |


---

## 一、 文档目的

本文档定义策略生命周期中每个验证关卡（Quality Gate）的具体通过标准，回答「怎么算通过」的问题 。所有标准须可被自动化系统执行，确保 AI Agent 能够无歧义地判断策略是否可以推进至下一阶段 。

### 验证门控的设计原则

* 
**客观可量化**：每项标准均有明确的数值阈值，不依赖主观判断 。


* 
**分层递进**：G1–G4 保障安全性，G5–G6 评估收益性，G7–G8 验证生产就绪 。


* 
**快速失败**：低成本的关卡（静态分析）优先执行，避免浪费计算资源 。


* 
**可配置**：阈值参数集中管理，不同策略类型可使用差异化配置 。



---

## 二、 关卡总览

策略从 `DRAFT` 到 `LIVE` 需通过 8 个关卡，由 SDK 全自动执行（G1–G6）或系统辅助人工确认（G7–G8） 。

| 关卡 | 流转区间 | 触发方式 | 通过标准 | 最短耗时 |
| --- | --- | --- | --- | --- |
| **G1 静态分析** | DRAFT → VALIDATED | 全自动 | 类型完整 + 参数合规 | < 30s |
| **G2 EVM 仿真** | DRAFT → VALIDATED | 全自动 | 链下链上结果位级对齐 | < 2min |
| **G3 不变性断言** | DRAFT → VALIDATED | 全自动 | 全部断言 100% 通过 | < 5min |
| **G4 Fuzzing** | DRAFT → VALIDATED | 全自动 | 1000 轮无破线 | < 30min |
| **G5 回测** | VALIDATED → EVALUATED | 全自动 | Sharpe/回撤/Gas 达标 | < 60min |
| **G6 蒙特卡洛** | VALIDATED → EVALUATED | 全自动 | 置信区间正收益 ≥ 60% | < 90min |
| **G7 影子对比** | SHADOWED → STAGED | 人工确认 | 偏差 ≤ ±15%，运行 ≥ 72h | ≥ 72h |
| **G8 Staged 验收** | STAGED → LIVE | 人工审批 | 7天无异常 + 管理员签字 | ≥ 7d |

---

## 三、 安全性关卡（G1–G4）

目标是证明策略在任何条件下都不会产生超出预期的损失 。

### G1 静态分析

在执行任何动态仿真前进行的最低成本检查 。

| 检查项 | 通过标准 | 失败处理 |
| --- | --- | --- |
| **接口完整性** | 实现 BaseStrategy 全部必填方法，无缺失 | 报告缺失方法名，拒绝进入后续关卡 |
| **invariants 非空** | 至少声明 1 个不变性约束（如 MaxDrawdown） | 提示开发者补充风控约束 |
| **风控参数类型** | 所有阈值参数类型正确且在合理范围内 | 报告具体字段和实际值 |
| **协议适配器存在** | 策略引用的所有 Adapter ID 在注册表中有效 | 列出无效 Adapter ID |
| **白名单合约** | 策略调用的合约地址全部在白名单内 | 列出未授权合约地址 |

### G2 EVM 仿真精度

验证链下计算与链上 Solidity 执行的一致性，消除系统性误差 。

| 测试场景 | 通过标准 | 可接受误差 |
| --- | --- | --- |
| **整数除法舍入** | 与 Solidity floor 除法结果一致 | 0（必须位级对齐） |
| **TickMath 计算** | sqrt(price) 计算结果与链上一致 | 0（必须位级对齐） |
| **uint256 溢出边界** | 边界值（0, 2^256-1）处理与链上一致 | 0 |
| **费率累积计算** | 多步费率复利结果与链上一致 | ≤ 1 wei |
| **流动性计算** | getLiquidityForAmounts 结果与合约一致 | ≤ 1 wei |

> 
> **执行方式**：对每个计算函数生成 500 组随机输入，对比 SDK 与 Anvil fork 调用结果 。
> 
> 

### G3 不变性断言

确保物理底线在标准场景下 100% 被满足，无例外 。

| 不变性类型 | 默认阈值 | 通过标准 | 说明 |
| --- | --- | --- | --- |
| **MaxDrawdown** | 单次执行 U 本位跌幅 ≤ 1% | 100% 满足 | 保护本金不被单次交易侵蚀 |
| **MaxSlippage** | 实际滑点 ≤ 声明滑点容忍度 | 100% 满足 | 防止流动性薄弱时的超额滑点 |
| **MaxGasMultiple** | 实际 Gas ≤ 估算 Gas × 3 | 100% 满足 | 防止 Gas 估算严重低估 |
| **PositionLimitPct** | 单策略持仓 ≤ 资金池上限比例 | 100% 满足 | 隔离单策略风险 |

### G4 极端 Fuzzing

主动注入极端参数测试鲁棒性，共计 1000 轮 。

| Fuzzing 维度 | 参数范围 | 轮次 | 通过标准 |
| --- | --- | --- | --- |
| **Gas 价格波动** | 1x ~ 1000x 基准 Gas | 200 | 无单次亏损超 MaxDrawdown |
| **流动性枯竭** | 目标池流动性降至 0.1% ~ 100% | 200 | 策略正确拒绝执行或降级处理 |
| **价格极端跳动** | ±10% ~ ±90% 单区块价格变化 | 200 | 三源预言机正确触发熔断 |
| **网络延迟/超时** | RPC 超时 0ms ~ 30s | 200 | FSM 正确进入等待状态 |
| **Nonce 冲突** | 并发发送相同 Nonce 交易 | 100 | 状态机正确处理，无资金丢失 |
| **区块重组** | 模拟 1~3 个区块的 reorg | 100 | FSM 检测到并回滚至正确状态 |

---

## 四、 绩效关卡（G5–G6）

证明策略在统计意义上具备正期望收益，且风险收益比可接受 。

### G5 历史回测

使用标准数据源在真实历史区块上重放 。

| 指标 | 默认通过阈值 | 备注 |
| --- | --- | --- |
| **回测时间跨度** | ≥ 90 天历史数据 | 须覆盖牛、熊、震荡市各一段 |
| **数据精度** | 交易级别（非 OHLC） | 须包含真实链上 tick 数据 |
| **年化 Sharpe Ratio** | ≥ 1.0 | 基准：无风险利率 = 0 |
| **最大回撤（MDD）** | ≤ 20% | 以 U 本位计算 |
| **Calmar Ratio** | ≥ 0.5 | 年化收益 / 最大回撤 |
| **总 Gas 成本占比** | ≤ 毛收益的 30% | 必须纳入净收益计算 |
| **盈亏比** | ≥ 1.3 | 总盈利 / 总亏损 |

### G6 蒙特卡洛模拟

通过 5000 轮模拟消除对特定历史路径的过拟合风险 。

| 统计指标 | 通过标准 | 含义 |
| --- | --- | --- |
| **正收益模拟占比** | ≥ 60% | 超过 60% 的随机场景下盈利 |
| **中位数年化收益** | ≥ 0% | 中位数场景不亏损 |
| **最差 5% 分位回撤** | ≤ 40% | 极端情况下损失可控 |
| **收益标准差** | ≤ 中位数收益的 3x | 收益分布不能过度发散 |

---

## 五、 生产就绪关卡（G7–G8）

需人工确认，但判断依据由系统自动计算提供 。

### G7 影子模式对比验收

验证策略在真实数据驱动下的行为是否符合预期（≥ 72 小时） 。

* 
**假设收益偏差**：与回测预期偏差 ≤ ±15% 。


* 
**触发频率偏差**：实际与回测预期偏差 ≤ ±30% 。


* 
**熔断误触率**：误触发次数 ≤ 5 次/天 。


* 
**系统稳定性**：无状态异常或对账差异 。



### G8 Staged 生产验收

用真实小额资金验证完整交易闭环（≥ 7 个自然日） 。

* 
**交易成功率**：≥ 95%（含 revert/Gas不足等） 。


* 
**对账差异**：零差异（账本与链上余额完全一致） 。


* 
**大额审批**：$10,000 以上单笔须走完审批流程 。


* 
**管理员签字**：资金负责人书面审批通过 。



---

## 六、 策略类型差异化阈值

根据不同策略的风险收益特征，自动应用差异化配置 。

| 指标 | 做市策略 | 套利策略 | 收益聚合 | 跨链再平衡 |
| --- | --- | --- | --- | --- |
| **最小 Sharpe** | ≥ 0.8 | ≥ 1.5 | ≥ 0.6 | ≥ 0.5 |
| **最大回撤** | ≤ 15% | ≤ 10% | ≤ 25% | ≤ 20% |
| **Gas 成本占比** | ≤ 40% | ≤ 20% | ≤ 30% | ≤ 50% |
| **正收益蒙卡占比** | ≥ 55% | ≥ 70% | ≥ 60% | ≥ 55% |
| **最短影子运行** | 72h | 48h | 72h | 96h |

---

## 七、 多指标裁决规则

出现冲突时按优先级裁决 ：

1. 
**P0 安全第一**：G1–G4 任一失败，立即终止 。


2. 
**P1 账实一致**：对账差异 > 0，立即暂停策略并人工核查 。


3. 
**P2 核心指标**：核心指标不达标（如回撤超限），整体判定失败 。


4. 
**P3 成本优化**：Gas 占比过高判定为失败，建议优化执行路径 。


5. 
**P4 辅助参考**：资金利用率偏低仅生成警告，不阻断流程 。



---

## 八、 验证报告输出规范

每次关卡执行后生成的结构化 JSON 报告须包含：

* 
**唯一标识**：`report_id` 和 `strategy_version_hash` 。


* 
**关卡结论**：PASS / FAIL / WARN 三态结论及原因 。


* 
**指标快照**：包含实际值、阈值和偏差百分比 。


* 
**可复现性**：记录数据源 `block_range` 和随机数种子 。


* 
**AI 可消费**：标准 JSON 格式，供 AI 生成优化建议 。


* 
**不可篡改**：报告生成后内容锁定，历史版本永久保留 。



---

**下一步建议**：您是否需要我为您生成一份符合该标准 G1 阶段的 JSON 报告示例，或者为您起草一份用于 G8 阶段的管理员签字审批表单？