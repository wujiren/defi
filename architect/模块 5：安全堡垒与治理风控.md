# 🏛️ 模块 5：安全堡垒与机构级 MPC 签名流

## 5.1 机构级 MPC 签名架构 (MPC Signing Orchestration)

为了实现“物理级隔离”，系统将决策逻辑与签名逻辑彻底拆分。AI 策略仅生成无签名的 Payload，签名由独立的 MPC 节点根据白名单规则自动完成。

* **签名沙盒 (Signing Sandbox)**：签名服务运行在独立、受限的网络环境中，与策略计算区物理隔离。
* **白名单强制过滤 (Whitelist Enforcement)**：MPC 节点在释放私钥分片前，会强制校验 Payload 目标地址是否在**合约白名单**中。
* **大额审批拦截流**：
* 当单笔交易金额超过大额审批阈值（当前占位值：$10,000）时，交易自动挂起，进入 `PENDING_APPROVAL` 状态。
* 必须由管理员在后端管理后台手动确认后，签名节点才允许释放签名。



---

## 5.2 技术实现：白名单拦截与阈值检查 (Go Logic)

在 Go 执行层（Fortress Zone）中，签名协调器在调用 MPC 接口前执行以下逻辑：

```go
// 签名协调器：在物理签名前的最后校验
func (s *SignerCoordinator) PreSignCheck(payload TradePayload, whitelist []Address) error {
    // 1. 物理白名单校验：拦截非预期地址
    if !isWhitelisted(payload.ToAddress, whitelist) {
        return fmt.Errorf("SECURITY_VIOLATION: Target address %s not in whitelist", payload.ToAddress)
    }

    // 2. 核心方法校验：仅允许白名单函数（如 swap, deposit）
    if !isAllowedMethod(payload.Data[:4]) {
        return fmt.Errorf("SECURITY_VIOLATION: Method %x not allowed", payload.Data[:4])
    }

    // 3. 大额阈值检查
    if payload.ValueUSD >= s.config.HighValueThreshold {
        // 标记为等待审批，挂起 FSM
        s.fsm.SetStatus(payload.TxID, "PENDING_APPROVAL")
        return fmt.Errorf("APPROVAL_REQUIRED: Transaction value exceeds threshold")
    }

    return nil
}

```

---

## 5.3 管理员时间锁与 Guardian 机制 (Timelock & Guardian)

针对核心风控参数（如最大滑点阈值、合约白名单）的修改，系统实施“慢速生效”原则。

* **24h 时间锁等待期**：修改核心参数的操作必须经过 24 小时（占位值）等待期后方可生效。
* **Guardian 一票否决权**：架构中预留一个高度隔离的“Guardian 钱包”。在等待期内，Guardian 可通过一笔高优先级交易取消任何潜在的危险变更。
* **决策因素**：最终参数需结合团队成员时区分布（确保审查时间）和紧急业务需求进行评审。

---

## 5.4 全局物理断路器 (Global Kill Switch)

在面临黑天鹅事件或底层协议被黑时，系统需具备“核武器”级的响应速度。

* **一键撤销授权 (Revoke)**：预置针对所有已授权 Token 的交易模板，可在 60 秒内完成所有撤销操作。
* **紧急提款路径**：维护一份各协议的“紧急提款函数映射表”，确保在极端情况下能迅速抽离流动性。
* **权限控制**：断路器支持 Web 后端、CLI 工具或基于特定预警信号（如协议被黑推特情报）的自动触发。

---

## 5.5 模块 5 评价标准 (Evaluation Standards)

| 维度 | **好架构 (Security First)** | **坏架构 (Risk Vulnerable)** |
| --- | --- | --- |
| **隔离程度** | AI 策略代码即使被黑，也无法将资金转出白名单地址。 | 只要拿到应用服务器权限，就能直接调用签名 API。 |
| **响应时效** | Kill Switch 演练表明可在 60 秒内撤销所有授权。 | 发生攻击时需要手动拼接交易，耗时以十分钟计。 |
| **透明度** | 核心参数变更拥有 24 小时公示期供团队复核。 | 核心参数可以被单个管理员私自即时修改。 |
| **合规性** | 大额交易必须经过人工二次确认，且有完整审计日志。 | 决策完全依赖 AI，缺乏人的最后一道关卡。 |

