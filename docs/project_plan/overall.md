# 开发计划概览（修订版 v2.0）

这是一份"策略先行、防爆兜底"的架构开发计划。该计划将整个系统拆解为五个阶段，通过明确的接口契约实现跨语言（Python/Go）并行开发。v2.0 版本在保障策略研发效率的同时，全面补齐了极高可用性要求下的外部依赖降级预案、自愈状态机与硬件级安全防线。

> **v2.0 修订说明：**
> 1. 全局引入环境隔离（DEV/STAGING/PROD）、灾难恢复（RTO/RPO）与证书生命周期管理规范。
> 2. 补齐 Phase 1 的 25 项评估指标计算库。
> 3. 补齐 Phase 2 的双分录会计引擎与 mTLS 证书自动化轮换脚本。
> 4. 补齐 Phase 3 的外部依赖降级预案（Chainlink / 治理 API）与 Recovery Manager 自愈状态机。
> 5. 补齐 Phase 4 的差异化审批引擎（STAGED vs LIVE）、Flashbots 降级预案与 MPC 密钥仪式（Key Ceremony）。

---

## Phase 0：奠基与契约对齐（并行启动期）

**目标：** 确立系统的"通用语言"与物理边界，消除跨模块开发时的阻塞。同步部署可观测性基础设施与全局预案规范。
**参与团队：** 全体架构师、DevOps、DBA、财务风控组

* **任务 1-2：接口契约与存储底座**
  固化 Protobuf 契约（严禁浮点数过境）；拉起 PostgreSQL 核心表（账本、任务锁）与 Redis Stream 管道。
* **任务 3：三区网络隔离与证书体系**
  划分 Zone A/B/C 物理网络；生成内部 Root CA，签发 90 天有效期的 mTLS 证书体系。
* **任务 4：可观测性基础设施部署**
  部署 Prometheus + Grafana + Loki 全套栈；建立 16 条告警规则空壳与 `defi_` 指标命名规范。
* **任务 5：制造假通道（Mocking）**
  交付 Zone B 假 gRPC Server、Zone C 假签名服务，解除 Phase 1 并行开工阻塞。

---

## Phase 1：策略大脑与回测预评估（AI 投研期）

**目标：** 优先让核心策略逻辑跑通，完成 G1 静态分析与 Adapter Registry。本阶段 G5/G6 为"预评估"（`PRE_EVAL`），非生产凭据。
**参与团队：** AI/策略组、数据工程组、区块链底层组

* **任务 1：历史数据归档与回测引擎**
  沉淀 Parquet 格式历史数据；实现零 Look-Ahead 防作弊的 `IDataProvider` 接口。
* **任务 2：G1 静态分析门控**
  开发 AST 静态扫描工具，拦截直接 RPC 调用、浮点金额转换等违规代码。
* **任务 3：Adapter Registry 基础框架**
  开发协议适配器注册表，确立白名单校验与治理哨兵的共同数据源。
* **任务 4-5：基类、指标库与首个策略**
  开发 **25 项评估指标计算库**；编写 CLAMM 首批策略并跑通 G5/G6 预评估。

---

## Phase 2：核心引擎与数学对齐（沙盒校准期）

**目标：** 消除跨语言计算误差，跑通 G1-G4 安全门控并产出 G5/G6 正式报告。交付财务双分录引擎与自动化运维脚本。
**参与团队：** 区块链底层开发组、财务风控组、AI 策略组、架构组

* **任务 1：Go EVM 仿真器（两档模式）**
  实现轻量档（P99 < 80ms）与完整档（P99 < 250ms）独立仿真的 EVM 内核。
* **任务 2-3：G2-G4 门控与状态机基础**
  通过 G2 位级对齐、G3 不变性断言、G4 极端 Fuzzing 测试；建立 FSM (`INIT → SIMULATED`) 与 Nonce 悲观锁。
* **任务 4：双分录会计核心引擎** *(新增重点)*
  实现 `ledger_entries` 原子记账与账实核查（Reconciler），拦截任何借贷不平衡。
* **任务 5-6：Admin Web Portal 与 MtM 估值**
  交付 Zone A 管理后台与大额审批队列；实现每区块更新的 NAV 估值与奖励扫描器。
* **任务 7 & 额外任务：官方评估与证书轮换**
  重跑 G5/G6 生成 `OFFICIAL` 评估报告；**交付 mTLS 证书自动轮换脚本**（距到期 30 天前强制交付）。

---

## Phase 3：实时数据与影子模式（虚拟实盘期）

**目标：** 接入真实 RPC，演练影子模式。激活水位线与预言机双重熔断，上线自愈状态机并验证外部依赖降级预案。
**参与团队：** 后端业务组、财务核算组、架构/SRE 组、区块链底层组

* **任务 1：实时链上事件推送**
  `Chain-Adapter` 接入真实 RPC，注入 `last_sync_block` 水位线。
* **任务 2：硬熔断防线与降级预案 A**
  激活 `Sync Sentinel` 水位线硬拦截与 `Triple-Oracle Guard`；**实装 Chainlink 长时间不更新的降级预案 A**。
* **任务 3-4：影子对账与 PAUSED/DEPRECATED 状态机**
  实现影子 PnL 核算；上线 7 条自动 PAUSED 规则与 DEPRECATED 退役清算流程。
* **任务 5：自愈状态机（Recovery Manager）与混沌测试** *(新增重点)*
  部署 `Recovery Manager` 扫描孤儿任务；在真实负载下执行"拔网线"测试，验证 **15 秒无损接管**能力。
* **任务 6：NFR 专项验收**
  在 STAGING 环境完成两档延迟、SLA（≥99.9%）、50 并发扩展性与数据可复现性验证。

---

## Phase 4：安全装甲与飞轮迭代（生产就绪期）

**目标：** 闭环物理层安全防线，防夹路由上线，通过第三方审计，最终闭合 AI 自我学习飞轮。
**参与团队：** 极高安全组、智能合约组、AI 组、第三方审计机构

* **任务 1：物理签名、差异化审批与 Key Ceremony**
  完成 **MPC 密钥分片仪式**；部署 Zone C 白名单代理；实现 STAGED（绝对金额 $10,000）与 LIVE（相对比例 15%）的**差异化大额审批引擎**；上线 Kill Switch 绿色通道。
* **任务 2：MEV 防夹路由与降级预案 C**
  上线 `MEV Router` 及动态 Gas 竞价；**实装 Flashbots 长期不可用时的降级预案 C**。
* **任务 3：断路器与治理哨兵（降级预案 D）**
  部署 24h 时间锁；上线治理哨兵并**实装 Snapshot/Tally 持续异常的兜底降级预案 D**。
* **任务 4：AI 审计闭环与进化飞轮**
  财务组满足 **60 秒 SLA** 投递软滑点与毒性流数据；AI 组向量化存入 Vector DB，生成 Prompt 驱动策略自主进化。
* **验收**：外部安全审计签核，执行 60 秒 Kill Switch 实盘演练，系统进入 LIVE 状态。